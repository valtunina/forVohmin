configfile: "config.yaml"

rule all:
    input:
        "results/top_10_words.txt"

rule download_book:
    output:
        "data/book.txt"
    params:
        url = config["book_url"]
    shell:
        "curl -L {params.url} -o {output} && echo '‚úÖ –ö–Ω–∏–≥–∞ —Å–∫–∞—á–∞–Ω–∞'"

rule count_words:
    input:
        "data/book.txt"
    output:
        "results/word_counts.tsv"
    run:
        # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Python –∫–æ–¥
        import re
        from collections import Counter
        import os
        
        print(f"üìñ –û–±—Ä–∞–±–æ—Ç–∫–∞: {input[0]}")
        
        with open(input[0], 'r', encoding='utf-8') as f:
            text = f.read()
        
        # –ù–∞—Ö–æ–¥–∏–º —Å–ª–æ–≤–∞
        words = re.findall(r'[a-zA-Z]+', text.lower())
        print(f"üìä –ù–∞–π–¥–µ–Ω–æ —Å–ª–æ–≤: {len(words):,}")
        
        # –°—á–∏—Ç–∞–µ–º
        counts = Counter(words)
        print(f"üî¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤: {len(counts):,}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        os.makedirs(os.path.dirname(output[0]), exist_ok=True)
        
        with open(output[0], 'w') as f:
            f.write("word\tcount\n")
            for word, count in counts.most_common():
                f.write(f"{word}\t{count}\n")
        
        print(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: {output[0]}")
        
        # –ü–æ–∫–∞–∂–µ–º —Ç–æ–ø-5
        print("\nüèÜ –¢–æ–ø-5 —Å–ª–æ–≤:")
        for i, (word, count) in enumerate(counts.most_common(5), 1):
            print(f"{i}. {word}: {count:,}")

rule top10:
    input:
        "results/word_counts.tsv"
    output:
        "results/top_10_words.txt"
    shell:
        "head -n 11 {input} > {output} && echo '‚úÖ –¢–æ–ø-10 —Å–æ–∑–¥–∞–Ω'"
